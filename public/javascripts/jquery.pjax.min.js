(function(d){d.fn.pjax=function(o,p){return this.live("click.pjax",function(q){e(q,o,p)})};function e(r,o,p){p=b(o,p);var q=r.currentTarget;if(q.tagName.toUpperCase()!=="A"){throw"$.fn.pjax or $.pjax.click requires an anchor element"}if(r.which>1||r.metaKey||r.ctrlKey){return}if(location.protocol!==q.protocol||location.host!==q.host){return}if(q.hash&&q.href.replace(q.hash,"")===location.href.replace(location.hash,"")){return}var s={url:q.href,container:d(q).attr("data-pjax"),target:q,clickedElement:d(q),fragment:null};d.pjax(d.extend({},s,p));r.preventDefault()}var m=d.pjax=function(y){y=d.extend(true,{},d.ajaxSettings,m.defaults,y);if(d.isFunction(y.url)){y.url=y.url()}var t=y.target;if(!t&&y.clickedElement){t=y.clickedElement[0]}var r=i(y.url).hash;var o=y.beforeSend,s=y.complete,x=y.success,v=y.error;var p=y.context=n(y.container);if(!y.data){y.data={}}y.data._pjax=p.selector;function q(A,z){var B=d.Event(A,{relatedTarget:t});p.trigger(B,z);return !B.isDefaultPrevented()}var u;y.beforeSend=function(B,A){if(A.timeout>0){u=setTimeout(function(){if(q("pjax:timeout",[B,y])){B.abort("timeout")}},A.timeout);A.timeout=0}B.setRequestHeader("X-PJAX","true");B.setRequestHeader("X-PJAX-Container",p.selector);var z;if(o){z=o.apply(this,arguments);if(z===false){return false}}if(!q("pjax:beforeSend",[B,A])){return false}y.requestUrl=i(A.url).href};y.complete=function(z,A){if(u){clearTimeout(u)}if(s){s.apply(this,arguments)}q("pjax:complete",[z,A,y]);q("pjax:end",[z,y]);q("end.pjax",[z,y])};y.error=function(C,D,A){var z=k("",C,y);if(v){v.apply(this,arguments)}var B=q("pjax:error",[C,D,A,y]);if(D!=="abort"&&B){window.location=z.url}};y.success=function(B,A,C){var z=k(B,C,y);if(!z.contents){window.location=z.url;return}m.state={id:y.id||f(),url:z.url,title:z.title,container:p.selector,fragment:y.fragment,timeout:y.timeout};if(y.push||y.replace){window.history.replaceState(m.state,z.title,z.url)}if(z.title){document.title=z.title}p.html(z.contents);if(typeof y.scrollTo==="number"){d(window).scrollTop(y.scrollTo)}if((y.replace||y.push)&&window._gaq){_gaq.push(["_trackPageview"])}if(r!==""){window.location.href=r}if(x){x.apply(this,arguments)}q("pjax:success",[B,A,C,y])};if(!m.state){m.state={id:f(),url:window.location.href,title:document.title,container:p.selector,fragment:y.fragment,timeout:y.timeout};window.history.replaceState(m.state,document.title)}var w=m.xhr;if(w&&w.readyState<4){w.onreadystatechange=d.noop;w.abort()}m.options=y;var w=m.xhr=d.ajax(y);if(w.readyState>0){d(document).trigger("pjax",[w,y]);if(y.push&&!y.replace){g.push(m.state.id,p.clone(true,true).contents());window.history.pushState(null,"",y.url)}q("pjax:start",[w,y]);q("start.pjax",[w,y]);q("pjax:send",[w,y])}return m.xhr};function f(){return(new Date).getTime()}function l(o){return o.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function i(p){var o=document.createElement("a");o.href=p;return o}function b(o,p){if(o&&p){p.container=o}else{if(d.isPlainObject(o)){p=o}else{p={container:o}}}if(p.container){p.container=n(p.container)}return p}function n(o){o=d(o);if(!o.length){throw"no pjax container for "+o.selector}else{if(o.selector!==""&&o.context===document){return o}else{if(o.attr("id")){return d("#"+o.attr("id"))}else{throw"cant get selector for pjax container!"}}}}function h(p,o){var q=d();p.each(function(){if(d(this).is(o)){q=q.add(this)}q=q.add(o,this)});return q}function k(q,s,p){var r={};r.url=l(s.getResponseHeader("X-PJAX-URL")||p.requestUrl);var o=d(q);if(o.length===0){return r}r.title=h(o,"title").last().text();if(p.fragment){var t=h(o,p.fragment).first();if(t.length){r.contents=t.contents();if(!r.title){r.title=t.attr("title")||t.data("title")}}}else{if(!/<html/i.test(q)){r.contents=o}}if(r.contents){r.contents=r.contents.not("title");r.contents.find("title").remove()}if(r.title){r.title=d.trim(r.title)}return r}m.reload=function(o,p){var q={url:window.location.href,push:false,replace:true,scrollTo:false};return d.pjax(d.extend(q,b(o,p)))};m.defaults={timeout:650,push:true,replace:false,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20};function j(){this.mapping={};this.forwardStack=[];this.backStack=[]}j.prototype.push=function(p,o){this.mapping[p]=o;this.backStack.push(p);while(this.forwardStack.length){delete this.mapping[this.forwardStack.shift()]}while(this.backStack.length>m.defaults.maxCacheLength){delete this.mapping[this.backStack.shift()]}};j.prototype.get=function(o){return this.mapping[o]};j.prototype.forward=function(p,o){this.mapping[p]=o;this.backStack.push(p);if(p=this.forwardStack.pop()){delete this.mapping[p]}};j.prototype.back=function(p,o){this.mapping[p]=o;this.forwardStack.push(p);if(p=this.backStack.pop()){delete this.mapping[p]}};var g=new j;m.click=e;var c=("state" in window.history),a=location.href;d(window).bind("popstate",function(s){var p=!c&&location.href==a;c=true;if(p){return}var t=s.state;if(t&&t.container){var o=d(t.container);if(o.length){var r=g.get(t.id);if(m.state){var u=m.state.id<t.id?"forward":"back";g[u](m.state.id,o.clone(true,true).contents())}var v=d.Event("pjax:popstate",{state:t,direction:u});o.trigger(v);var q={id:t.id,url:t.url,container:o,push:false,fragment:t.fragment,timeout:t.timeout,scrollTo:false};if(r){d(document).trigger("pjax",[null,q]);o.trigger("pjax:start",[null,q]);o.trigger("start.pjax",[null,q]);if(t.title){document.title=t.title}o.html(r);m.state=t;o.trigger("pjax:end",[null,q]);o.trigger("end.pjax",[null,q])}else{d.pjax(q)}o[0].offsetHeight}else{window.location=location.href}}});if(d.inArray("state",d.event.props)<0){d.event.props.push("state")}d.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);if(!d.support.pjax){d.pjax=function(p){var o=d.isFunction(p.url)?p.url():p.url,s=p.type?p.type.toUpperCase():"GET";var q=d("<form>",{method:s==="GET"?"GET":"POST",action:o,style:"display:none"});if(s!=="GET"&&s!=="POST"){q.append(d("<input>",{type:"hidden",name:"_method",value:s.toLowerCase()}))}var r=p.data;if(typeof r==="string"){d.each(r.split("&"),function(t,u){var v=u.split("=");q.append(d("<input>",{type:"hidden",name:v[0],value:v[1]}))})}else{if(typeof r==="object"){for(key in r){q.append(d("<input>",{type:"hidden",name:key,value:r[key]}))}}}d(document.body).append(q);q.submit()};d.pjax.click=d.noop;d.pjax.reload=window.location.reload;d.fn.pjax=function(){return this}}})(jQuery);